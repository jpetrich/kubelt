<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" content="text/html" http-equiv="Content-Type" />
		<meta content="" name="description" />
		<title>Kubelt SDK Reference</title>
 		<link rel="stylesheet" type="text/css" href="css/shCore.css" />
		<style type="text/css">.syntaxhighlighter{overflow:hidden !important;}</style>
		<link rel="stylesheet" type="text/css" href="css/shThemeMarginalia.css" />
		<link rel="stylesheet" type="text/css" href="css/marginalia.css" />
		<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="js/xregexp-min.js"></script>
		<script type="text/javascript" src="js/shCore.js"></script>
		<script type="text/javascript" src="js/shBrushClojure.js"></script>
	</head>
	<body>
		<table>
			<tr>
				<td class="docs">
					<div class="docs-header">
						<a class="anchor" href="#repl" name="repl">
							<h1 class="project-name">digest.cljc</h1>
							<a class="toc-link" href="index.html">toc</a>
						</a>
					</div>
				</td>
				<td class="codes" />
			</tr>
			<tr>
				<td class="docs">
					<p>Compute hash digests.</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure">(ns com.kubelt.lib.crypto.digest
  {:copyright &quot;Â©2022 Proof Zero Inc.&quot; :license &quot;Apache 2.0&quot;}
  #?(:clj
     (:import
      [java.security MessageDigest]
      [org.bouncycastle.crypto.digests
       Blake3Digest
       KeccakDigest
       SHA256Digest
       SHA3Digest])
     :cljs
     (:require
      [&quot;@stablelib/sha256&quot; :as sha256]
      [&quot;@stablelib/sha3&quot; :as sha3]))
  (:require
   [com.kubelt.lib.crypto.hexify :as lib.hexify]
   [com.kubelt.lib.octet :as lib.octet]))</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<p>There are more digest algorithms supported in BouncyCastle that may be of interest, including:</p><ul><li>SHA384Digest</li><li>SHA512Digest</li><li>SHAKEDigest</li><li>TigerDigest</li><li>WhirlpoolDigest</li></ul>
				</td>
				<td class="codes">
					<pre class="brush: clojure"></pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<p>There are crypto algorithms supported in the ClojureScript "standard library":</p><ul><li>goog.crypt.Aes</li><li>goog.crypt.Arc4</li><li>goog.crypt.Cbc</li><li>goog.crypt.Hmac</li><li>goog.crypt.Sha256</li></ul>
				</td>
				<td class="codes">
					<pre class="brush: clojure"></pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<h2>Internal</h2>
				</td>
				<td class="codes">
					<pre class="brush: clojure"></pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<p>Takes some digest bytes and a map describing the digest, and returns a standard digest map.</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure">(defn- digest-map
  [digest-bytes desc-map]
  (let [hex-string (lib.hexify/hex-string digest-bytes)]
    (merge desc-map
           {:com.kubelt/type :kubelt.type/crypto.digest
            :digest/bytes digest-bytes
            :digest/hex-string hex-string})))</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<p>Invoke the passed-in hash digest implementation to compute the hash of some data. The description map describes the algorithm being passed in.</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure">(defn- compute-digest
  [digest description data-bytes]
  {:pre [(map? description)]}
  #?(:clj
     ;; Wrap the invocation of a BouncyCastle digest.
     (let [offset 0
           data-length (alength data-bytes)]
       ;; Compute the digest of all the passed in bytes.
       (.update digest data-bytes offset data-length)
       (let [;; Final hash bytes written into this byte array.
             digest-bytes (byte-array (.getDigestSize digest))
             byte-count (.doFinal digest digest-bytes 0)]
         (digest-map digest-bytes description)))
     :cljs
     ;; Wrap the invocation of a StableLib digest.
     (do
       (.update digest data-bytes)
       (let [digest-bytes (.digest digest)]
         (digest-map digest-bytes description)))))</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<h2>Public</h2>
				</td>
				<td class="codes">
					<pre class="brush: clojure"></pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<p>Compute the SHA2-256 digest of some data.</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure">#_(defn blake3
  &quot;Compute the Blake3 digest of some data.&quot;
  [data]
  (let [description {:digest/algorithm :digest.algorithm/blake3
                     :digest/byte-length 32
                     :digest/bit-length 256}]
    #?(:clj
       (let [digest (Blake3Digest.)]
         (compute-digest digest description data))
       :cljs
       ;; TODO waiting for StableLib implementation of Blake3.
       :not-yet-implemented)))
(defn sha2-256
  [data]
  (let [description {:digest/algorithm :digest.algorithm/sha2-256
                     :digest/byte-length 32
                     :digest/bit-length 256}
        digest #?(:clj (SHA256Digest.)
                  :cljs (sha256/SHA256.))
        data-bytes (lib.octet/as-bytes data)]
    (compute-digest digest description data-bytes)))</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<p>Compute the SHA3-256 (Keccak) digest of some data.</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure">(defn sha3-256
  [data]
  (let [description {:digest/algorithm :digest.algorithm/sha3-256
                     :digest/byte-length 32
                     :digest/bit-length 256}
        digest #?(:clj (SHA3Digest.)
                  :cljs (sha3/SHA3256.))
        data-bytes (lib.octet/as-bytes data)]
    (compute-digest digest description data-bytes)))</pre>
				</td>
			</tr>
			<tr>
				<td class="spacer docs">&nbsp;</td>
				<td class="codes" />
			</tr>
		</table>
		<div class="footer">Generated by <a href="https://github.com/captain-porcelain/sidenotes">Sidenotes</a>.&nbsp;&nbsp;Syntax highlighting provided by Alex Gorbatchev's <a href="http://alexgorbatchev.com/SyntaxHighlighter/">SyntaxHighlighter</a>
		</div>
		<script type="text/javascript" src="js/app.js"></script>
	</body>
</html>
