<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" content="text/html" http-equiv="Content-Type" />
		<meta content="" name="description" />
		<title>Kubelt SDK Reference</title>
 		<link rel="stylesheet" type="text/css" href="css/shCore.css" />
		<style type="text/css">.syntaxhighlighter{overflow:hidden !important;}</style>
		<link rel="stylesheet" type="text/css" href="css/shThemeMarginalia.css" />
		<link rel="stylesheet" type="text/css" href="css/marginalia.css" />
		<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="js/xregexp-min.js"></script>
		<script type="text/javascript" src="js/shCore.js"></script>
		<script type="text/javascript" src="js/shBrushClojure.js"></script>
	</head>
	<body>
		<table>
			<tr>
				<td class="docs">
					<div class="docs-header">
						<a class="anchor" href="#repl" name="repl">
							<h1 class="project-name">com.kubelt.rpc.schema-test</h1>
							<a class="toc-link" href="index.html">toc</a>
						</a>
					</div>
				</td>
				<td class="codes" />
			</tr>
			<tr>
				<td class="docs">
					<p>Test rpc schema</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure">(ns com.kubelt.rpc.schema-test
  (:require
   [cljs.core.async :refer [go]]
   [cljs.core.async.interop :refer-macros [&lt;p!]]
   [cljs.reader :refer [read-string]]
   [cljs.test :as t :refer [deftest is testing async]]
   [com.kubelt.lib.test-utils :as lib.test-utils]
   [com.kubelt.rpc :as rpc]
   [com.kubelt.rpc.schema :as rpc.schema]
   [com.kubelt.rpc.schema.fs :as s.fs]
   [com.kubelt.rpc.schema.parse :as rpc.schema.parse]))</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def data {:openrpc &quot;1.2.6&quot;,
           :info {:title &quot;Kubelt Core&quot;, :version &quot;0.0.0&quot;},
           :methods
           [{:name &quot;kb_ping&quot;,
             :params [],
             :result {:name &quot;pong&quot;, :schema {:type &quot;string&quot;}}}]})</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(defn check-keys [parsed]
  (is (= (set (keys parsed)) #{:rpc/version :rpc/metadata :rpc/servers :rpc/methods})
      &quot;failing parsed expected keys&quot;))</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(deftest parse-schema-test
  (testing &quot;parsing rpc api (in edn format)&quot;
    (let [parsed (rpc.schema.parse/parse data {})]
      (check-keys parsed))))</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(deftest parse-be-schema-test
  (testing &quot;checks on be.edn &quot;
    (async done
           (go
             (try
               (let [data (read-string (str (&lt;p! (s.fs/read-file&amp; (str lib.test-utils/json-path &quot;oort.edn&quot;)))))
                     parsed (rpc.schema.parse/parse data {})]
                 (check-keys parsed)
                 (let [client (rpc.schema/schema (rpc/init) data)]
                   (is (= #{[:kb :auth] [:kb :ping] [:kb :pong]
                            [:kb :auth :verify] [:kb :core :create]
                            [:kb :core :add :signer]}
                          (rpc/available client))
                       &quot;failing methods&quot;)
                   (is (=
                        {:com.kubelt/type :kubelt.type/rpc.request,
                         :rpc/path [:kb :ping],
                         :rpc/method
                         {:method/name &quot;kb_ping&quot;,
                          :method/summary nil,
                          :method/params {},
                          :method.params/all [],
                          :method.params/required [],
                          :method.params/optional [],
                          :method.params/schemas {}}}
                        (-&gt; (rpc/prepare client [:kb :ping] {})
                            (select-keys   [:com.kubelt/type :rpc/path :rpc/method])))
                       &quot;failing ping prepare expectations&quot;)))
               (catch js/Error err (js/console.log err))
               (finally (done)))))))</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<p>TODO uncomment once our parser works with \$refs</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure"></pre>
				</td>
			</tr>
			<tr>
				<td class="spacer docs">&nbsp;</td>
				<td class="codes" />
			</tr>
		</table>
		<div class="footer">Generated by <a href="https://github.com/captain-porcelain/sidenotes">Sidenotes</a>.&nbsp;&nbsp;Syntax highlighting provided by Alex Gorbatchev's <a href="http://alexgorbatchev.com/SyntaxHighlighter/">SyntaxHighlighter</a>
		</div>
		<script type="text/javascript" src="js/app.js"></script>
	</body>
</html>
