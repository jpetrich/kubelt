<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" content="text/html" http-equiv="Content-Type" />
		<meta content="" name="description" />
		<title>Kubelt SDK Reference</title>
 		<link rel="stylesheet" type="text/css" href="css/shCore.css" />
		<style type="text/css">.syntaxhighlighter{overflow:hidden !important;}</style>
		<link rel="stylesheet" type="text/css" href="css/shThemeMarginalia.css" />
		<link rel="stylesheet" type="text/css" href="css/marginalia.css" />
		<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="js/xregexp-min.js"></script>
		<script type="text/javascript" src="js/shCore.js"></script>
		<script type="text/javascript" src="js/shBrushClojure.js"></script>
	</head>
	<body>
		<table>
			<tr>
				<td class="docs">
					<div class="docs-header">
						<a class="anchor" href="#repl" name="repl">
							<h1 class="project-name">com.kubelt.rpc.schema</h1>
							<a class="toc-link" href="index.html">toc</a>
						</a>
					</div>
				</td>
				<td class="codes" />
			</tr>
			<tr>
				<td class="docs">
					<p>Tools for working with OpenRPC schemas.</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure">(ns com.kubelt.rpc.schema
  {:copyright &quot;Â©2022 Proof Zero Inc.&quot; :license &quot;Apache 2.0&quot;}
  (:require
   [com.kubelt.lib.error :as lib.error :refer-macros [conform*]]
   [com.kubelt.rpc.schema.fs :as rpc.schema.fs]
   [com.kubelt.rpc.schema.parse :as rpc.schema.parse]
   [com.kubelt.rpc.schema.util :as rpc.schema.util]
   [com.kubelt.spec.rpc.client :as spec.rpc.client]
   [com.kubelt.spec.rpc.discover :as spec.rpc.discover]
   [com.kubelt.spec.rpc.github :as spec.rpc.github]
   [com.kubelt.spec.rpc.http :as spec.rpc.http]
   [com.kubelt.spec.rpc.inflate :as spec.rpc.inflate]
   [com.kubelt.spec.rpc.schema :as spec.rpc.schema]))</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<h2>schema</h2>
				</td>
				<td class="codes">
					<pre class="brush: clojure"></pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<p>Load a pre-parsed schema into the RPC client.</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure">(defn schema
  ([client schema-doc]
   (let [prefix ::default]
     (schema client prefix schema-doc)))
  ([client prefix schema-doc]
   (let [defaults {}]
     (schema client prefix schema-doc defaults)))
  ([client prefix schema-doc options]
   (conform*
    [spec.rpc.client/client client]
    [spec.rpc.client/prefix prefix]
    [spec.rpc.schema/schema schema-doc]
    [spec.rpc.schema/options options]
    ;; TODO check options for separator, e.g. &quot;.&quot;, &quot;_&quot; (use regex? set of chars?)
    (let [defaults {}
          options (merge defaults options)
          ;; Analyze schema and convert to client map.
          parsed-schema (rpc.schema.parse/parse schema-doc options)]
      (if (lib.error/error? parsed-schema)
        parsed-schema
        (assoc-in client [:rpc/schemas prefix] parsed-schema))))))</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<h2>inflate</h2>TODO rework to use guardsTODO handle promise/future
				</td>
				<td class="codes">
					<pre class="brush: clojure"></pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<p>Load an OpenRPC schema document from the filesystem and use it to initialize the RPC client.</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure">(defn inflate
  ([client filename]
   (let [prefix ::default]
     (inflate client prefix filename)))
  ([client prefix filename]
   (let [defaults {}]
     (inflate client prefix filename defaults)))
  ([client prefix filename options]
   (conform*
    [spec.rpc.client/client client]
    [spec.rpc.client/prefix prefix]
    [spec.rpc.inflate/filename filename]
    [spec.rpc.inflate/options options]
    (let [;; This is an edn value representing the schema, if
          ;; successful, but will be an error map if an issue occurred.
          schema-doc (rpc.schema.fs/read-schema filename)]
      (if (lib.error/error? schema-doc)
        schema-doc
        ;; Inject the loaded schema into the client.
        (let [defaults {}
              options (merge defaults options)]
          (schema client prefix schema-doc options)))))))</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<h2>discover</h2>
				</td>
				<td class="codes">
					<pre class="brush: clojure"></pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<p>Given a provider URL, fetch the schema document using the standard OpenRPC discovery process (via an rpc.discover call).</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure">(defn discover
  ([client url]
   (let [prefix ::default]
     (discover client prefix url)))
  ([client prefix url]
   (let [defaults {}]
     (discover client prefix url defaults)))
  ([client prefix url options]
   (conform*
    [spec.rpc.client/client client]
    [spec.rpc.client/prefix prefix]
    [spec.rpc.discover/url url]
    [spec.rpc.discover/options options]
    :fixme)))</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<h2>http</h2>
				</td>
				<td class="codes">
					<pre class="brush: clojure"></pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<p>Fetch a schema document from the given URL and load it into the client.</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure">(defn http
  ([client url]
   (let [prefix ::default]
     (http client prefix url)))
  ([client prefix url]
   (let [defaults {}]
     (http client prefix url defaults)))
  ([client prefix url options]
   (conform*
    [spec.rpc.client/client client]
    [spec.rpc.client/prefix prefix]
    [spec.rpc.http/url url]
    [spec.rpc.http/options options]
    :fixme)))</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<h2>github</h2>
				</td>
				<td class="codes">
					<pre class="brush: clojure"></pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<p>Fetch a schema document from a GitHub repository and load it into the client.</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure">(defn github
  ([client repo]
   (let [prefix ::default]
     (github client prefix repo)))
  ([client prefix repo]
   (let [defaults {}]
     (github client prefix repo defaults)))
  ([client prefix repo options]
   (conform*
    [spec.rpc.client/client client]
    [spec.rpc.client/prefix prefix]
    [spec.rpc.github/repo repo]
    [spec.rpc.github/options options]
    :fixme)))</pre>
				</td>
			</tr>
			<tr>
				<td class="spacer docs">&nbsp;</td>
				<td class="codes" />
			</tr>
		</table>
		<div class="footer">Generated by <a href="https://github.com/captain-porcelain/sidenotes">Sidenotes</a>.&nbsp;&nbsp;Syntax highlighting provided by Alex Gorbatchev's <a href="http://alexgorbatchev.com/SyntaxHighlighter/">SyntaxHighlighter</a>
		</div>
		<script type="text/javascript" src="js/app.js"></script>
	</body>
</html>
