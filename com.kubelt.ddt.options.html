<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" content="text/html" http-equiv="Content-Type" />
		<meta content="" name="description" />
		<title>Kubelt SDK Reference</title>
 		<link rel="stylesheet" type="text/css" href="css/shCore.css" />
		<style type="text/css">.syntaxhighlighter{overflow:hidden !important;}</style>
		<link rel="stylesheet" type="text/css" href="css/shThemeMarginalia.css" />
		<link rel="stylesheet" type="text/css" href="css/marginalia.css" />
		<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="js/xregexp-min.js"></script>
		<script type="text/javascript" src="js/shCore.js"></script>
		<script type="text/javascript" src="js/shBrushClojure.js"></script>
	</head>
	<body>
		<table>
			<tr>
				<td class="docs">
					<div class="docs-header">
						<a class="anchor" href="#repl" name="repl">
							<h1 class="project-name">com.kubelt.ddt.options</h1>
							<a class="toc-link" href="index.html">toc</a>
						</a>
					</div>
				</td>
				<td class="codes" />
			</tr>
			<tr>
				<td class="docs">
					<p>Common options various sub-commands.</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure">(ns com.kubelt.ddt.options
  {:copyright &quot;Â©2022 Proof Zero Inc.&quot; :license &quot;Apache 2.0&quot;}
  (:require
   [&quot;path&quot; :as path])
  (:require
   [clojure.set :as cset]
   [clojure.string :as cstr]))</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<h2>Defaults</h2>
				</td>
				<td class="codes">
					<pre class="brush: clojure"></pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def scheme-default
  &quot;http&quot;)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def scheme-choices
  #js [&quot;http&quot; &quot;https&quot;])</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def host-default
  &quot;127.0.0.1&quot;)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def p2p-port-default
  8787)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def ipfs-port-default
  5001)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<h2>Options</h2>
				</td>
				<td class="codes">
					<pre class="brush: clojure"></pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def log-level
  &quot;log-level&quot;)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def log-config
  #js {:describe &quot;set the logging level&quot;
       :default &quot;warn&quot;
       :choices #js [&quot;log&quot;
                     &quot;trace&quot;
                     &quot;debug&quot;
                     &quot;info&quot;
                     &quot;warn&quot;
                     &quot;error&quot;
                     &quot;fatal&quot;
                     &quot;report&quot;
                     &quot;spy&quot;]})</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def tls-name
  &quot;tls&quot;)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def tls-config
  #js {:describe &quot;make request with(out) TLS&quot;
       :boolean true})</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def host-name
  &quot;host&quot;)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def host-config
  #js {:alias &quot;h&quot;
       :describe &quot;p2p service host&quot;
       :requiresArg true
       :demandOption &quot;service host is required&quot;
       :string true
       :nargs 1
       :default host-default})</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def port-name
  &quot;port&quot;)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def port-config
  #js {:alias &quot;p&quot;
       :describe &quot;p2p service port&quot;
       :requiresArg true
       :demandOption &quot;service port is required&quot;
       :number true
       :nargs 1
       :default p2p-port-default})</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def wallet-name
  &quot;wallet&quot;)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def wallet-config
  #js {:alias &quot;w&quot;
       :describe &quot;a wallet name&quot;
       :requiresArg true
       :demandOption &quot;wallet must be specified&quot;
       :string true
       :nargs 1})</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def ipfs-read-scheme
  &quot;ipfs-read-scheme&quot;)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def ipfs-read-scheme-config
  #js {:describe &quot;use http or https to talk to IPFS read instance&quot;
       :requiresArg true
       :demandOption &quot;scheme is required&quot;
       :choices scheme-choices
       :nargs 1
       :default scheme-default})</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def ipfs-read-host
  &quot;ipfs-read-host&quot;)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def ipfs-read-host-config
  #js {:describe &quot;host address of IPFS read instance&quot;
       :requiresArg true
       :demandOption &quot;address is required&quot;
       :string true
       :nargs 1
       :default host-default})</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def ipfs-read-port
  &quot;ipfs-read-port&quot;)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def ipfs-read-port-config
  #js {:describe &quot;port of IPFS read instance&quot;
       :requiresArg true
       :demandOption &quot;port is required&quot;
       :number true
       :nargs 1
       :default ipfs-port-default})</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def ipfs-write-scheme
  &quot;ipfs-write-scheme&quot;)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def ipfs-write-scheme-config
  #js {:describe &quot;use http or https to talk to IPFS write instance&quot;
       :requiresArg true
       :demandOption &quot;scheme is required&quot;
       :choices scheme-choices
       :nargs 1
       :default scheme-default})</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def ipfs-write-host
  &quot;ipfs-write-host&quot;)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def ipfs-write-host-config
  #js {:describe &quot;address of IPFS write instance&quot;
       :requiresArg true
       :demandOption &quot;address is required&quot;
       :string true
       :nargs 1
       :default host-default})</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def ipfs-write-port
  &quot;ipfs-write-port&quot;)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def ipfs-write-port-config
  #js {:describe &quot;port of IPFS write instance&quot;
       :requiresArg true
       :demandOption &quot;port is required&quot;
       :number true
       :nargs 1
       :default ipfs-port-default})</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def jwt-name
  &quot;jwt&quot;)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def jwt-config
  #js {:describe &quot;A core name and associated JWT&quot;
       :requiresArg true
       :array true
       :nargs 2})</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<p>All of these options are required. NB: the options with supplied defaults won't cause an error if not supplied by user.</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure">(def required-options
  #js [host-name
       port-name
       wallet-name])</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<h2>Public</h2>
				</td>
				<td class="codes">
					<pre class="brush: clojure"></pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					
				</td>
				<td class="codes">
					<pre class="brush: clojure">(defn options
  [yargs]
  ;; Add --log-level option
  (.option yargs log-level log-config)
  ;; Add --(no-)tls option
  (.option yargs tls-name tls-config)
  ;; Add --host option
  (.option yargs host-name host-config)
  ;; Add --port option
  (.option yargs port-name port-config)
  ;; Add --ipfs-read-scheme
  (.option yargs ipfs-read-scheme ipfs-read-scheme-config)
  ;; Add --ipfs-read-host option
  (.option yargs ipfs-read-host ipfs-read-host-config)
  ;; Add --ipfs-read-port option
  (.option yargs ipfs-read-port ipfs-read-port-config)
  ;; Add --ipfs-write-scheme
  (.option yargs ipfs-write-scheme ipfs-write-scheme-config)
  ;; Add --ipfs-write-host option
  (.option yargs ipfs-write-host ipfs-write-host-config)
  ;; Add --ipfs-write-port option
  (.option yargs ipfs-write-port ipfs-write-port-config)
  ;; Add --wallet option
  (.option yargs wallet-name wallet-config)
  ;; Add --jwt option
  (.option yargs jwt-name jwt-config)
  ;; Indicate which options must be provided
  (.demandOption yargs required-options)
  ;; Pretend like this is functional
  yargs)</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<p>Convert arguments object to a Clojure map, ensuring that common options are transformed appropriately.</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure">(defn to-map
  [args]
  (let [;; The parsed arguments are returned as a #js object. Convert to
        ;; a CLJS map with keywords as keys.
        m (js-&gt;clj args :keywordize-keys true)
        ;; The string array of arguments is provided with the
        ;; key &quot;_&quot;. Rename it to something a bit friendlier.
        m (cset/rename-keys m {:_ :args})
        ;; Get the name of the application that was invoked; store in
        ;; the arguments map as something that is namespace qualified,
        ;; i.e. com.kubelt.\$name.
        base-name (.basename path (get m :\$0))
        app-name (cstr/join &quot;.&quot; [&quot;com&quot; &quot;kubelt&quot; base-name])
        ;; Store the p2p service coordinates.
        tls (get m :tls)
        p2p-scheme (if tls :https :http)
        p2p-host (get m :host)
        p2p-port (get m :port)
        ;; Store coordinates of IPFS read host.
        ipfs-read-scheme (keyword (get m :ipfs-read-scheme))
        ipfs-read-host (get m :ipfs-read-host)
        ipfs-read-port (get m :ipfs-read-port)
        ;; Store coordinates of IPFS write host.
        ipfs-write-scheme (keyword (get m :ipfs-write-scheme))
        ipfs-write-host (get m :ipfs-write-host)
        ipfs-write-port (get m :ipfs-write-port)
        ;; Turn a sequence of core names and JWT strings into a map:
        ;; [&quot;aaa&quot; &quot;bbb&quot; &quot;ccc&quot; &quot;ddd&quot;]
        ;; =&gt; {&quot;aaa&quot; &quot;bbb&quot;, &quot;ccc&quot; &quot;ddd&quot;}
        jwts (get m :jwt)
        credentials (apply hash-map jwts)]
    (-&gt; m
        (assoc :app-name app-name)
        (assoc :p2p-scheme p2p-scheme)
        (assoc :p2p-host p2p-host)
        (assoc :p2p-port p2p-port)
        (assoc :ipfs-read-scheme ipfs-read-scheme)
        (assoc :ipfs-read-host ipfs-read-host)
        (assoc :ipfs-read-port ipfs-read-port)
        (assoc :ipfs-write-scheme ipfs-write-scheme)
        (assoc :ipfs-write-host ipfs-write-host)
        (assoc :ipfs-write-port ipfs-write-port)
        (assoc :credentials credentials)
        (update :log-level keyword))))</pre>
				</td>
			</tr>
			<tr>
				<td class="docs">
					<p>Transform an argument map into a map of options that can be used to initialize the SDK. The argument map should contain arguments provided on the command line, and have been transformed from a JavaScript object to a Clojure map using (to-map).</p>
				</td>
				<td class="codes">
					<pre class="brush: clojure">(defn init-options
  [m]
  {:pre [(map? m)]}
  {:credential/jwt (get m :credentials)
   :log/level (get m :log-level)
   :ipfs.read/scheme (get m :ipfs-read-scheme)
   :ipfs.read/host (get m :ipfs-read-host)
   :ipfs.read/port (get m :ipfs-read-port)
   :ipfs.write/scheme (get m :ipfs-write-scheme)
   :ipfs.write/host (get m :ipfs-write-host)
   :ipfs.write/port (get m :ipfs-write-port)
   :p2p/scheme (get m :p2p-scheme)
   :p2p/host (get m :p2p-host)
   :p2p/port (get m :p2p-port)})</pre>
				</td>
			</tr>
			<tr>
				<td class="spacer docs">&nbsp;</td>
				<td class="codes" />
			</tr>
		</table>
		<div class="footer">Generated by <a href="https://github.com/captain-porcelain/sidenotes">Sidenotes</a>.&nbsp;&nbsp;Syntax highlighting provided by Alex Gorbatchev's <a href="http://alexgorbatchev.com/SyntaxHighlighter/">SyntaxHighlighter</a>
		</div>
		<script type="text/javascript" src="js/app.js"></script>
	</body>
</html>
